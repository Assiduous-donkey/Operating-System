# 内存管理

## 重定位

1. 物理地址空间指内存物理单元的集合，是地址转换的最终地址。进程在运行时执行指令和访问数据，最后都要通过物理地址从主存中存取。当装入程序将可执行代码装入内存时，必须通过地址转换将逻辑地址转换为物理地址，这一过程称为重定位。

2. 重定位导致**无法在编译时检查绝对地址**

## 内存审查

1. 多道程序和共享内存技术要求一个进程不能对其他进程进行有意或无意的非授权访问。

2. 内存分配之前需要保护操作系统不受用户进程的影响，同时保护用户进程不受其他用户进程的影响。通过**重定位寄存器和界限寄存器**来实现。

3. 界限寄存器包含最大的物理地址值。程序在运行时首先将逻辑地址加上基址寄存器的值产生一个绝对地址，然后将得到的结果与界限寄存器比较，若该绝对地址不在界限范围内，则操作系统发出中断信号响应越界错误。

## 组织

1. 逻辑组织是**操作系统可执行的程序的结构**。

2. 物理组织是**程序在内存中的存放结构**。

## 覆盖技术与交换技术

1. 覆盖技术：把用户空间分成固定区和覆盖区。固定区存放经常需要执行的程序部分。其他部分放在外存中，在即将需要被访问时放入覆盖区

2. 交换技术：在内存不足时将某些进程的内容移到外存，把外存中要执行的进程换进内存，占用前者原来的区域。

3. 覆盖技术发生在同一进程之内，交换技术发生在不同进程之间。

## 伙伴系统

伙伴系统是针对固定分区（内部碎片）和动态分区（外部碎片）的折中方案。

1. 可用的内存大小为$2^k,L<=k<=U$，最小块大小为$2^L$

2. 初始空间为最大块大小：$2^U$

3. 请求一块内存S时首先寻找一块最小的可满足S的内存块M，**若$S*2<=M$则将M均分为两块M1和M2，再取其中任意一块与S进程比较，做同样的操作直到不可再均分**，最后给S分配一个均分到最小程度的块。

4. 释放内存后若被释放的块的伙伴未被分配则将两者合并。

## 分页和分段的区别

1. 页式存储：用户空间划分为大小相等的部分，称为页。内存空间划分为同样大小的区域，称为页框。逻辑上相邻的页在物理上不一定相邻。

    - 页表：由OS为每个进程建立并维护

    - OS还维护一个空闲页框的列表

    - **页对齐：保证指令的完整性，使得一条指令不会被分割到不同的页**

2. 段式存储：用户空间按自身逻辑关系划分为若干段（代码段、数据段、堆栈段等），内存空间被动态划分为**长度不同**的区域，分配时以段为单位，每段在内存中占据连续空间。

3. 区别：

    - 分页是基于系统管理的要求，结合虚拟内存扩充内存空间；分段是基于用户应用的需要。

    - 页的大小固定，适用于虚拟存储；段的大小不固定，常用于内存保护。

    - 分段是二维地址空间（段号+段内偏移），分页是一维地址空间（每个进程一个页表，通过一个逻辑地址就能找到对应的物理地址，因为页号固定）

    - 分段易于实现共享和保护，便于动态链接。

    - 分段存在外部碎片，分页存在内部碎片。
