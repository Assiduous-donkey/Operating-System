# 裸机编程

电脑开机时首先执行的是磁盘上一处**引导扇区**的程序，由该程序启动(装入)操作系统。所以要在裸机上编程，我们也应该先在引导扇区上编程。引导扇区的大小只是一个扇区，一般是**512个字节**，位于软盘的第一个扇区。若我们要在裸机上运行较大的程序，可以将程序放在其他地方然后从引导扇区**跳转**到对应位置执行。

程序以软盘映像文件的形式装入虚拟机

## 流程

1. 编写汇编程序

2. 编译汇编程序，转为二进制代码。NASM程序的编译指令为：nasm 文件名.asm

3. 借助软盘读写工具，如(HxD)打开二进制代码，将代码复制到软盘上要放置的位置。

4. 将软盘装入虚拟机，启动

## 程序编写

1. 访问显存：采用段式结构，由自己设计程序的逻辑地址(段地址:偏移地址)。其中显存的段地址是B800，ES段寄存器指向文本模式(最小可控制单位为字符，25X80)的显式缓冲区。
ES不能用立即数直接初始化。

```nasm
mov ax,b800h
mov es,ax
```

显存的段地址上偶地址是要显示的字符，对应的下一个奇地址是字符的属性

```nasm
mov byte[es:0x00],'T'
mov byte[es:0x01],0x07  ;07属性为黑底白字
```

## BIOS调用

BIOS(basic input output system)，是一组固化到计算机内主板上一个ROM芯片上的程序。它保存着计算机最重要的基本输入输出程序、系统设置信息、开机后自检程序和系统自动启动程序。

### 自诊断

通过读取CMOS RAM中的内容**识别硬件配置**并对其进行自检和初始化

### 自启动

在自检成功后将磁盘相对的0道0扇区上的引导程序装入内存，在装入时，优先使用内存中最低端的偏移量为**7C00H**的一段区域作为存放区域

### BIOS中断

是微机系统、硬件之间的一个可编程接口。如对键盘或硬盘等硬件的操作。
调用方法：

```nasm
mov ah,功能号
(设置各种入口参数)
int 中断号
```

## 单道批处理

使用一个监控程序调度不同汇编程序的执行。各程序共用一个CPU，依次使用CPU资源。程序之间可以采用按键切换的模式或者执行完一个再执行另一个的模式。“调度”实际上是“跳转”，跳转到下一个到执行的程序的地址

不同程序放在软盘(磁盘)上的不同位置，调度时要使用读磁盘中断：

```nasm
mov ah,2    ; 2号功能
mov al,要读取的扇区数
mov dl,驱动器号(软盘为0)
mov dh,磁头号(起始编号为0)
mov ch,柱面号(起始编号为0)
mov cl,起始扇区号
(es:bx指定缓冲区地址)
int 13h     ; 磁盘中断的2号功能：读磁盘
```
